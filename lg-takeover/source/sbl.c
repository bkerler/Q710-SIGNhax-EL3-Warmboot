#include "sbl.h"

const uint8_t raw_resources_a_guid[16] = {0x27, 0xAE, 0x27, 0x46, 0xEF, 0xCF, 0xA1, 0x48, 0x88, 0xFE, 0x99, 0xC3, 0x50, 0x9A, 0xDE, 0x26};
const uint8_t aboot_a_guid[16] = {0xCD, 0xFD, 0x0F, 0x40, 0xE0, 0x22, 0xE7, 0x47, 0x9A, 0x23, 0xF1, 0x6E, 0xD9, 0x38, 0x23, 0x88};
const uint8_t sbl1_a_guid[16] = {0x2C, 0xBA, 0xA0, 0xDE, 0xDD, 0xCB, 0x05, 0x48, 0xB4, 0xF9, 0xF4, 0x28, 0x25, 0x1C, 0x3E, 0x98};
const uint8_t sec_guid[16] = {0xC3, 0x6A, 0x3E, 0x30, 0x15, 0xAF, 0x54, 0x4C, 0x9E, 0x9B, 0xD9, 0xA8, 0xFB, 0xEC, 0xF4, 0x01};

uint8_t* sbl_res_guid_orig;

void sbl_init()
{
    sbl_framebuffer = (uint8_t*)0x90000000;
    sbl_res_guid = (uint8_t**)0x0802BDB8;
    
    sbl_fbfill = (void*)(0x0802A93C+1);
    sbl_fbupdate = (void*)(0x0802AAF4+1);
    sbl_fbupdate2 = (void*)(0x08033DD0+1);
    sbl_coninit = (void*)(0x08028C7C+1);
    sbl_reset = (void*)(0x0800828E + 1);
    sbl_sleep_us = (void*)(0x08035B58+1);
    sbl_screen_log_msg = (void*)(0x0801B4FE + 1);
    sbl_uart_log_msg = (void*)(0x08020C4C + 1);
    sbl_dload_enter = (void*)(0x08041AB8 + 1);
    sbl_get_image_data = (void*)(0x0802BD1C + 1);
    sbl_start = (void*)(0x0);
    sbl_process_configs = (void*)(0x08042220 + 1);
    sbl_deinit_screen = (void*)(0x08033838 + 1);
    sbl_pre_aboot = (void*)(0x803CBEC + 1);
    
    sbl_res_guid_orig = *sbl_res_guid;
}

void sbl_switch_partition(const uint8_t* guid)
{
    *sbl_res_guid = (uint8_t*)guid;
}

void sbl_restore_partition(void)
{
    *sbl_res_guid = sbl_res_guid_orig;
}
